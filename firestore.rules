// firestore.rules
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // User profile doc
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;

      // Subcollections like customFoods, customExercises, plans
      match /{collection=**}/{docId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }
    }

      match /users/{uid}/diary/{date} {
    allow read, write: if request.auth != null && request.auth.uid == uid;
  }

    // Daily activities: activities/{uid}_{YYYY-MM-DD}
    match /activities/{activityId} {
      allow read, write: if request.auth != null
        && activityId.matches('^' + request.auth.uid + '_\\d{4}-\\d{2}-\\d{2}$');
    }

    // Conversations: conversations/{uid_YYYY-MM-DD}
    match /conversations/{convId} {
      allow read, write: if request.auth != null
        && convId.matches('^' + request.auth.uid + '_\\d{4}-\\d{2}-\\d{2}$');
    }
  }
}